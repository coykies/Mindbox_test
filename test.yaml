#---------------------------------
# Manifest file to create for test company Mindbox
# by Prytkov Sem github: coykies   
#---------------------------------
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-web-deployment
  label:
    app  : my-k8s-application
    env  : production-ready
    owner: PrytkovSem
spec: 
  #replicas: 4 # run 4 pods (Don't need if we are using HorizontalPodAutoscaler)
  selector:
    matchLabeles:
      project: mindbox
  template:
    metadata:
      label:
        project: mindbox
    spec:
      containers:
        - name : mindbox-app
          image: nginx:latest
          ports:
            - containerPort: 80
#Для установки ресурсных значений было принято решение использовать Horizontal Pod Autoscaling
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: my-web-deployment-autoscaling
  label:
    app  : my-k8s-application-autoscaling
    env  : production-ready
    owner: PrytkovSem
spec:
  scaleTargetRef:
      apiVersion: apps/v2
      kind: Deployment
      name: my-web-deployment
    minReplicas: 4
    maxReplicas: 4
    metrics:
    # устанавливаем лимиты на поды
    - type: Resource
      resource:
    #лимит потребления 0.1 CPU (для минимизирования потребления ресуросов) оптимальный requests 0.1 (согласно требованиям)
    #limits = requests для Guaranteed QoS
        limits:
          cpu: "0.1"
        requests:
          cpu: "0.1"
    #В момент старта значительно больше - 0.5 CPU
      args:
      - -cpus
      - "0.5"
    #Ресурсы памяти так же аналогичны (в условиях) 128 Мб
    - type: Resource
      resource:
        limits:
          memory: 128Mi
        requests:
          memory: 128Mi

